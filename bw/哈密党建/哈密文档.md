# 积分排行榜逻辑
## 查询部门下的人员
```sql
select count(*) from hmdj_party_operator where PART_BRANCH_ID ='571da461b4a7aaf382dc624dfd4e5288'
```
## 查询总分数
``` sql
select
	case
		when sum(hec.SCORE) is null then 0
		when sum(hec.SCORE) is not null then sum(hec.SCORE)
	end as totalScore
from
	hmdj_evaluate_content hec
left join hmdj_evaluate_type het on
	hec.TYPE_ID = het .ID
left join hmdj_evaluate_version hev on
	hev.ID = het.VERSION_ID
left join hmdj_evaluate_group heg on
	heg.ID = hev.GROUP_ID
where
	hev.STATUS = '5'
	and heg.DELETED = '0'
	and heg.dept_id = '571da461b4a7aaf382dc624dfd4e5288'
```
## 查询规则
```sql
SELECT t.party_branch_id AS partyBranchId, t.rule1 AS rule1, t.type AS type, t.rule2 AS rule2 FROM hmdj_evaluate_rules t WHERE t.type = '月度' and t.party_branch_id = '571da461b4a7aaf382dc624dfd4e5288'
```
## 查询部门下的人员分数
```sql
select
	t.id as id,
	t.apply_year as applyYear,
	t.apply_month as applyMonth,
	t.pmember_id as pmemberId,
	t.party_branch_id as partyBranchId,
	t.party_branch_name as partyBranchName,
	t.month_task_id as monthTaskId,
	t.apply_time as applyTime,
	t.apply_examine_time as applyExamineTime,
	t.apply_check_time as applyCheckTime,
	t.apply_score as applyScore,
	t.apply_examine_score as applyExamineScore,
	t.apply_check_score as applyCheckScore,
	t.task_status as taskStatus,
	t.apply_examiner_id as applyExaminerId,
	t.apply_checker_id as applyCheckerId,
	t.announcer_id as announcerId,
	t.pmember_name as pmemberName,
	t.return_flag as returnFlag,
	t.first_veto_flag as firstVetoFlag,
	t.second_veto_flag as secondVetoFlag,
	t.ranking as ranking,
	t.billboard_state as billboardState,
	t.performance as performance,
	t.apply_deadline as applyDeadline,
	t.group_id as groupId,
	t.version_id as versionId,
	t.appeal_result as appealResult,
	t.appeal_score as appealScore,
	t.appeal_time as appealTime,
	t.appeal_review_time as appealReviewTime,
	t.appeal_check_time as appealCheckTime
from
	hmdj_pmember_evaluation_task t
where
	t.apply_year = '2023'
	and t.apply_month = '07'
	and t.party_branch_id = '571da461b4a7aaf382dc624dfd4e5288'
	and t.task_status in ( '4' , '5' )
order by
	convert(t.APPLY_CHECK_SCORE,
	SIGNED) desc
```
# sql 文档
``` sql
-- 积分榜规则
-- hmdj.hmdj_evaluate_rules definition

CREATE TABLE `hmdj_evaluate_rules` (
  `party_branch_id` varchar(100) DEFAULT NULL COMMENT '党支部id',
  `rule1` varchar(10) DEFAULT NULL COMMENT '规则1',
  `type` varchar(100) DEFAULT NULL COMMENT '类型: 1.月度,2.季度3.年度',
  `rule2` varchar(10) DEFAULT NULL COMMENT '规则2'
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='积分榜规则';



-- hmdj_new.hmdj_evaluate_template definition

CREATE TABLE `hmdj_evaluate_template` (
  `id` varchar(40) NOT NULL,
  `dw_id` varchar(40) DEFAULT NULL COMMENT '党委id',
  `dw_name` varchar(100) DEFAULT NULL COMMENT '党委名称',
  `evaluate_id` varchar(100) DEFAULT NULL COMMENT '指数模板',
  `create_time` timestamp NULL DEFAULT NULL COMMENT '创建时间',
  `create_by` varchar(100) DEFAULT NULL COMMENT '创建者',
  `evaluate_name` varchar(100) DEFAULT NULL COMMENT '评价指数名称',
  `dzb_id` varchar(100) DEFAULT NULL COMMENT '党支部id',
  `dzb_name` varchar(100) DEFAULT NULL COMMENT '党支部名称',
  `create_id` varchar(100) DEFAULT NULL COMMENT '创建者id',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='评价模板';


//补充sql
drop table if exists `hmdj_evaluate_group_sign` 
CREATE TABLE `hmdj_evaluate_group_sign` (
  `id` varchar(40) DEFAULT NULL COMMENT 'id',
  `evaluate_group_id` varchar(40) DEFAULT NULL COMMENT '指标分组id',
  `user_id` varchar(40) DEFAULT NULL COMMENT '用户id',
  `deal_result` varchar(10) DEFAULT NULL COMMENT '0. 未处理 1.同意 2. 不同意',
  `one_sign` varchar(10) DEFAULT NULL COMMENT '一键会签 0.否 1. 是',
  `deal_end` varchar(10) DEFAULT NULL COMMENT '处理结束 0.否 1.是',
  `create_time` timestamp NULL DEFAULT NULL COMMENT '创建时间',
  `update_time` timestamp NULL DEFAULT NULL COMMENT '更新时间',
  KEY `hmdj_evaluate_group_sign_user_id_IDX` (`user_id`) USING BTREE,
  KEY `hmdj_evaluate_group_sign_evaluate_group_id_IDX` (`evaluate_group_id`) USING BTREE
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='评价指标会签表';

INSERT INTO t_dict_code
(code_id, dict_id, code_value, code_desc, priority, parent_value, children_text, code_key)
VALUES('hqcodeid4', 'hqztid', '0', '待会签', 8, '', '', '待会签');
INSERT INTO t_dict_code
(code_id, dict_id, code_value, code_desc, priority, parent_value, children_text, code_key)
VALUES('hqcodeid3', 'hqztid', '0', '已会签', 8, '', '', '已会签');
INSERT INTO t_dict_code
(code_id, dict_id, code_value, code_desc, priority, parent_value, children_text, code_key)
VALUES('hqcodeid2', 'hqztid', '0', '待发布', 8, '', '', '待发布');
INSERT INTO t_dict_code
(code_id, dict_id, code_value, code_desc, priority, parent_value, children_text, code_key)
VALUES('hqcodeid1', 'hqztid', '0', '已发布', 8, '', '', '已发布');

INSERT INTO t_dict_info
(dict_id, dict_eng, dict_chn, dict_status, remark)
VALUES('hqztid', 'hqzt', '会签状态', '1', '会签状态');

```

# 会签
- 待会签,将会签的待发布,和已发布的都设置成未

# 模板功能
- 评价体系管理, 将已有的数据,设置成模板
  包括: 党委,党支部,评价指数
- 将模板里面关联的内容复制,指定的分类下

# 积分排行榜
- 查询列表分类: 
  - 月度
  - 季度
  - 年度
- 规则: 根据党支部,时间维度,查询 每个列表查询列表的比例
- 具体查询: 根据规则查询头部具体显示的比例
- 接口的划分:
  - 根据查询头部列表的数据
  - 根据原来的列表查询分页

# 访问数据库
- facade 数据库
  - mysql (主库)
    - url:jdbc:mysql://10.1.18.47:13316/hmdj
    - userName: root
    - password: Xj_xm123
  - oracle (从库)
    - url: jdbc:oracle:thin:@192.168.19.170:1521:xjxm
    - userName: hmdjuser
    - password: Xj_xm123!
- frapi 数据库
  - oracle 
    - url: jdbc:oracle:thin:@192.168.19.170:1521:xjxm
    - userName: hmdjuser
    - password: Xj_xm123!
# 访问地址
- 本地开发环境
  - app
    - http://localhost:8080/#/
  - web 
    - http://localhost:18080/hmdj/pointsReview
# app 登录
- 后端  
   放行 /hmdj/sys/getUserInfoApp

# 账号
- authManager  Booway@1
- lgm  Booway@1